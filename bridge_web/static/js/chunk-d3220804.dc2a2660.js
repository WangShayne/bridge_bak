(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d3220804"],{"05f3":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dashboard-container"},[a("el-container",[a("el-container",[a("el-main",[a("div",{staticClass:"container",style:{height:e.h+"px"}},[a("el-card",{attrs:{"body-style":{padding:"0px"}}},[a("Player",{ref:"realPlayer",attrs:{"camera-id":e.bridge.cameraId,h:e.componentH}})],1),a("el-card",{attrs:{"body-style":{padding:"0px"}}},[a("Player",{ref:"player",attrs:{"camera-id":e.bridge.cameraId,h:e.componentH}})],1),a("el-card",{attrs:{"body-style":{padding:"0px"},h:e.componentH}},[a("Message",{attrs:{warnings:e.warings,"gate-id":e.$route.meta.gateId},on:{warningEvent:e.receiveWaring,cancelWarningEvent:e.receiveCancelWarning}})],1),a("el-card",{attrs:{"body-style":{padding:"0px"}}},[a("Map",{attrs:{lng:e.bridge.lng,lat:e.bridge.lat,h:e.componentH}})],1)],1)])],1)],1)],1)},n=[],i=(a("159b"),a("99af"),a("b0c0"),a("a434"),a("d81d"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"message",style:{height:e.h+"px"}},[a("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.tableData,(function(t,r){return a("el-collapse-item",{key:t.id,attrs:{title:t.id,name:r}},e._l(t.data,(function(t){return a("el-form",{key:t.key,class:e.warnings?"warning-flash-bg":"",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:t.transTime,"label-width":"180px"}},[a("span",{staticStyle:{display:"inline-block",width:"210px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},[e._v(e._s(t.deviceData))])])],1)})),1)})),1)],1)])}),l=[],s=a("2909"),o=(a("a9e3"),a("ed08")),c={name:"Message",props:{warnings:{type:Boolean,default:!1},gateId:{type:String,default:""},h:{type:Number,default:0}},data:function(){return{tableData:[],activeNames:[0]}},computed:{},mounted:function(){var e=this,t=this;t.$options.sockets.onmessage=function(a){var r=a.data,n=JSON.parse(r);0===n.code&&n.devices.forEach((function(a){if(a.gate_id===t.gateId){var r=t.tableData.length&&t.tableData.some((function(e,t){return a.id===e.id}));a.alert&&e.$emit("warningEvent",a.id),a.data.forEach((function(e){var t=Number(e.time+"000");e.transTime=Object(o["c"])(new Date(t),"{y}-{m}-{d} {h}:{i}:{s}"),e.key=Object(o["b"])()})),r?t.tableData.forEach((function(e,t){if(e.id===a.id){var r;(r=e.data).push.apply(r,Object(s["a"])(a.data));var n=e.data.length;n>22&&e.data.splice(0,n-22)}})):t.tableData.push(a)}}))}},methods:{rowClass:function(e){var t=this;return t.warnings?"warning-flash-bg":""}}},p=c,u=(a("6b0c"),a("2877")),d=Object(u["a"])(p,i,l,!1,null,null,null),y=d.exports,h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"player",style:{height:e.h+"px"},attrs:{id:e.playerId}})},f=[],g=a("1da1"),m=(a("96cf"),a("b775"));function v(e){return Object(m["a"])({url:"/api/kitToken",method:"get",params:e})}var b="imou://open.lechange.com";function w(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"".concat(b,"/").concat(e,"/").concat(t,"/").concat(a,"?streamId=").concat(r)}function k(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return"".concat(b,"/").concat(e,"/").concat(t,"/").concat(a,"?streamId=").concat(r,"&recordType=localRecord&beginTime=").concat(n,"&endTime=").concat(i)}var T={name:"Player",props:{cameraId:{type:String,default:"6L08B12PAG2D445"},h:{type:Number,default:0}},data:function(){return{playerId:"player-"+Object(o["b"])(),player:null,kitToken:"",playerType:"live"}},computed:{},mounted:function(){var e=this;this.$nextTick((function(){e.initPlayer()}))},methods:{initPlayer:function(){var e=this;e.player=new e.ImouPlayer("#".concat(e.playerId))},realPlay:function(e,t){var a=this;return Object(g["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=a,null!=t.player&&(t.playerStop(),t.playerDestroy()),e.next=4,v({deviceId:t.cameraId,channelId:0});case 4:r=e.sent,t.kitToken=r.data.kitToken,t.player=new t.ImouPlayer("#".concat(t.playerId)),console.log(t.player.playerSet),t.player.setup({src:[{url:w(t.cameraId,0,1,1),kitToken:t.kitToken}],width:"100%",height:"100%",poster:"",autoplay:!0,controls:!0}),t.playerType="live",t.clearSplitWindow();case 11:case"end":return e.stop()}}),e)})))()},playerPlay:function(e,t){var a=this;return Object(g["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=a,null!=n.player&&(n.playerStop(),n.playerDestroy()),r.next=4,v({deviceId:n.cameraId,channelId:0});case 4:i=r.sent,n.kitToken=i.data.kitToken,n.player=new n.ImouPlayer("#".concat(n.playerId)),n.player.setup({src:[{url:k(n.cameraId,0,2,1,e,t),kitToken:n.kitToken}],width:"100%",height:"100%",poster:"",autoplay:!0,controls:!0}),n.playerType="record",n.clearSplitWindow();case 10:case"end":return r.stop()}}),r)})))()},clearSplitWindow:function(){this.$nextTick((function(){for(var e=document.querySelectorAll(".player__split"),t=0;t<e.length;t++)e[t].style.display="none"}))},playerStop:function(){var e=this;e.player.stop(),e.playerType="live"},playerDestroy:function(){var e=this;e.player.destroy(),e.playerType="live"},getState:function(){var e=this;if(console.log(e.player),e.player&&e.player.playerSet.length>0)return e.player.playerSet[0].isPlaying},getPlayerType:function(){return this.playerType}}},$=T,x=(a("8b6f"),Object(u["a"])($,h,f,!1,null,"00e09ad8",null)),I=x.exports,S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("baidu-map",{staticClass:"map",style:{height:e.h+"px"},attrs:{"map-click":!1,"scroll-wheel-zoom":"",zoom:e.zoom,center:e.center},on:{ready:e.handler}})],1)},D=[],P={name:"Map",components:{},props:{lng:{type:String,default:"118.814297"},lat:{type:String,default:"31.956533"},h:{type:Number,default:0}},data:function(){return{map:null,BMap:null,center:{lng:0,lat:0},zoom:3,channel:[],active:!1}},computed:{},created:function(){var e=this;e.handler({},e.lng,e.lat)},methods:{handler:function(e,t,a){e.BMap,e.map;this.center.lng=t,this.center.lat=a,this.zoom=16}}},O=P,j=(a("9a46"),Object(u["a"])(O,S,D,!1,null,"691394bc",null)),M=j.exports,_={name:"Bridges",components:{Message:y,Player:I,Map:M},data:function(){return{map:null,BMap:null,center:{lng:0,lat:0},zoom:3,channel:[],active:!1,warings:!1,errMessage:null,errList:[],timer1:null,playType:"live",h:0,componentH:0}},computed:{list:function(){return this.$store.state.bridge.list},bridge:function(){var e=this.$route.meta.id,t=this.$store.state.bridge.list,a={};return t.forEach((function(t){t.id===e&&(a=Object.assign(a,t))})),a}},created:function(){},mounted:function(){var e=this;this.h=this.$getViewportSize().height-80,this.componentH=this.h/2,this.$nextTick((function(){e.$refs.realPlayer.realPlay()}))},methods:{test1:function(){this.receiveWaring()},receiveWaring:function(e){var t=this,a=this;this.warings=!0;var r=a.errList.indexOf(e);if(r<0){a.errList.push(e),clearTimeout(a.timer1),a["errMsg"+e]=this.$message({showClose:!0,message:"警告!".concat(a.bridge.name,"设备").concat(e,"检测到撞击!"),type:"error",duration:3e4,onClose:function(){a["errMsg"+e]=null,a.warings=!1,a.errList.splice(a.errList.indexOf(e),1)}});var n=this.$refs.player.getPlayerType(),i=this.$refs.player.getState();i&&"live"!==n||(a.timer1=setTimeout((function(){var e=(new Date).getTime()-2e4,r=(new Date).getTime()+5e3;t.$refs.player.playerPlay(Object(o["c"])(new Date(e),"{y}-{m}-{d} {h}:{i}:{s}"),Object(o["c"])(new Date(r),"{y}-{m}-{d} {h}:{i}:{s}")),t.$refs.player&&(t.$refs.player.playerStop(),t.$refs.player.playerDestroy()),clearTimeout(a.timer1)}),5e3))}},receiveCancelWarning:function(e){var t=this;if(this.warings&&(this.warings=!1),t["errMsg"+e]){t["errMsg"+e].close(),t["errMsg"+e]=null;var a=t.errList.indexOf(e);a>0&&t.errList.splice(a,1)}this.$refs.player&&(this.$refs.player.playerStop(),this.$refs.player.playerDestroy())},test2:function(){this.$refs.player.realPlay(),console.log(this.$refs.player.getState())},test3:function(){var e=this;e.errList.map((function(t){e.receiveCancelWarning(t)}))},test4:function(){console.log(this.$refs.player.getState()),this.$refs.player&&(this.$refs.player.playerStop(),this.$refs.player.playerDestroy())},test5:function(){console.log(this.list),console.log(this.$route.meta.gateId),console.log(this.bridge)},test6:function(){var e=(new Date).getTime()-2e4,t=(new Date).getTime()+5e3;this.$refs.player.playerPlay(Object(o["c"])(new Date(e),"{y}-{m}-{d} {h}:{i}:{s}"),Object(o["c"])(new Date(t),"{y}-{m}-{d} {h}:{i}:{s}"))}}},C=_,E=(a("451a"),Object(u["a"])(C,r,n,!1,null,"4f3bb383",null));t["default"]=E.exports},"328b":function(e,t,a){},"451a":function(e,t,a){"use strict";a("d335")},"6b0c":function(e,t,a){"use strict";a("86f1")},"86f1":function(e,t,a){},"8b6f":function(e,t,a){"use strict";a("328b")},"9a46":function(e,t,a){"use strict";a("ddaf")},d335:function(e,t,a){},ddaf:function(e,t,a){}}]);